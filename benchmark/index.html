<html>
<head>
<title>Web Array Math API benchmark</title>
<script type="text/javascript" src="../polyfill/SIMD.js"></script>
<script>
  var self = {};
</script>
<script>
  var poly = {};
  self = poly;
</script>
<script type="text/javascript" src="../polyfill/webarraymath.js"></script>
<script>
  var polyasm = {};
  self = polyasm;
</script>
<script type="text/javascript" src="../polyfill/webarraymath-asm.js"></script>
<script type="text/javascript" src="benchmark.js"></script>
<script type="text/javascript">
function Run() {
  var asmjs = document.querySelector('input[name=poly][checked]').value === "poly-asm";
  var module = asmjs ? polyasm : poly;

  var text = "";
  var println = function (msg) {
    text += msg + "\n"
  };
  try {
    Benchmark(println, module.ArrayMath, module.Filter, module.FFT);
  } catch (err) {
    println(err.message);
  }
  document.getElementById("output").textContent += text;
}

function RunInWorker() {
  var asmjs = document.querySelector('input[name=poly]:checked').value === "poly-asm";
  var myWorker = new Worker("benchmarkworker.js");
  myWorker.onmessage = function (oEvent) {
    document.getElementById("output").textContent += oEvent.data + "\n";
  }
  myWorker.onerror = function (oEvent) {
    document.getElementById("output").textContent += "ERROR: " +
        oEvent.filename + "(" + oEvent.lineno + "): " +  oEvent.message + "\n";
  }
  myWorker.postMessage(asmjs);
}

function ClearOutput() {
  document.getElementById("output").textContent = "";
}
</script>
<style type="text/css">
body {
  font-family: sans-serif;
}
</style>
</head>
<body>
<h2>Web Array Math API benchmark</h2>
<p>You can find some early benchmark results <a href="results.html">here</a>.</p>

<p>Warning: "Run in main thread" is not recommended - it's just there to test
that things work as expected both in workers and in the main thread.</p>
<div>
<label><input type="radio" name="poly" value="poly" checked />Regular polyfill</label><br />
<label><input type="radio" name="poly" value="poly-asm" />asm.js polyfill</label><br />
<input type="submit" value="Run in worker" onclick="RunInWorker()" />
<input type="submit" value="Run in main thread" onclick="Run()" />
<input type="submit" value="Clear output" onclick="ClearOutput()" />
</div>
<pre id="output"></pre>
</body>
</html>
